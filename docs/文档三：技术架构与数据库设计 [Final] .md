### ðŸ“‚ æ–‡æ¡£ä¸‰ï¼šæŠ€æœ¯æž¶æž„ä¸Žæ•°æ®åº“è®¾è®¡ [Final]

> **é€‚ç”¨å¯¹è±¡**ï¼šSupabase é…ç½® / åŽç«¯é€»è¾‘
> **é¡¹ç›®ä»£å·**ï¼š`flip_word`

#### 1. æŠ€æœ¯æ ˆ

* **App**: Flutter + Riverpod + flutter_animate
* **Backend**: Supabase (PostgreSQL + Auth)
* **Local DB**: Isar (ç”¨äºŽç¦»çº¿ç¼“å­˜å•è¯æ•°æ®)

#### 2. æ•°æ®åº“æ¨¡åž‹ (Schema)

å»ºè®®åœ¨ Supabase SQL Editor ä¸­ç›´æŽ¥è¿è¡Œä»¥ä¸‹å»ºè¡¨é€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š

```sql
-- 1. ç”¨æˆ·æ¡£æ¡ˆè¡¨ (profiles)
create table profiles (
  id uuid references auth.users not null primary key,
  nickname text,
  stardust int default 0, -- æ˜Ÿå°˜æ•°é‡
  created_at timestamp with time zone default timezone('utc'::text, now())
);

-- 2. å•è¯è¡¨ (words - é™æ€æ•°æ®)
create table words (
  id bigint generated by default as identity primary key,
  text text not null, -- å•è¯æ‹¼å†™
  phonetic text,      -- éŸ³æ ‡
  definition text,    -- ä¸­æ–‡é‡Šä¹‰
  part_of_speech text, -- è¯æ€§ (n., v., adj.)
  rarity text check (rarity in ('common', 'rare', 'epic', 'legend')), -- ç¨€æœ‰åº¦
  theme_id int,       -- å¯¹åº”ä¸»é¢˜ID
  forms jsonb         -- è¯å½¢å˜åŒ– {"past": "ran", "plural": "runs"}
);

-- 3. ç”¨æˆ·å•è¯è¿›åº¦è¡¨ (user_words - æ ¸å¿ƒå­˜æ¡£)
create table user_words (
  user_id uuid references auth.users not null,
  word_id bigint references words(id) not null,
  is_collected boolean default false, -- æ˜¯å¦å·²å¼€å‡ºï¼ˆç‚¹äº®å›¾é‰´ï¼‰
  star_level int default 1,           -- æ˜Ÿçº§ (1-3)
  
  -- SM-2 ç®—æ³•å‚æ•°
  next_review_at timestamp with time zone, -- ä¸‹æ¬¡å¤ä¹ æ—¶é—´
  interval int default 0,                  -- é—´éš”å¤©æ•°
  ease_factor float default 2.5,           -- éš¾åº¦ç³»æ•°
  
  primary key (user_id, word_id)
);

-- 4. ä¸»é¢˜è¡¨ (themes)
create table themes (
  id bigint generated by default as identity primary key,
  name text, -- e.g., 'æ°´æžœä¹å›­'
  emoji text -- e.g., 'ðŸŽ'
);

```

#### 3. æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ (ä¼ªä»£ç )

**é‡å¤å¡è½¬æ˜Ÿå°˜é€»è¾‘ (Edge Function):**

```dart
// å½“ç”¨æˆ·å¼€åŒ…èŽ·å¾—å¡ç‰‡æ—¶
void onCardObtained(User user, Word word) {
  if (user.hasCollected(word)) {
    // é‡å¤å¡ -> å˜æ˜Ÿå°˜
    int dustAmount = getDustByRarity(word.rarity); // æ™®é€š5, ç¨€æœ‰15...
    user.addStardust(dustAmount);
    showToast("å¡ç‰‡é‡å¤ï¼ŒåŒ–ä½œäº† ${dustAmount} æ˜Ÿå°˜âœ¨");
  } else {
    // æ–°å¡ -> ç‚¹äº®å›¾é‰´
    user.collect(word);
    showAnimation("New Card!");
  }
}

```

---